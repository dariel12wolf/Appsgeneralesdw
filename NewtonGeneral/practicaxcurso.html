<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cursos</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- CORRECCIÓN RESPONSIVE --- */
        * { box-sizing: border-box; } 
        
        :root {
            --bg: #f4f6f9; --text: #333;
            --col-mate: #0049c6; --col-ciencias: #20bf6b;
            --col-letras: #eb3b5a; --col-sociales: #f7b731;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg);
            margin: 0; padding: 20px 20px 90px;
            color: var(--text);
            overflow-x: hidden; 
            width: 100%;
            position: relative;
        }

        .header-bar { display: flex; align-items: center; margin-bottom: 20px; width: 100%; }
        .header-title { font-weight: 900; font-size: 24px; color: #0049c6; flex: 1; text-align: center; margin-right: 34px; }

        .back-btn {
            font-size: 22px; color: #333; cursor: pointer; padding: 10px;
            background: white; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; 
        }
        .back-btn:active { transform: scale(0.9); }

        /* Filtros */
        .filter-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scrollbar-width: none; width: 100%; }
        .filter-chip { background: white; padding: 8px 18px; border-radius: 20px; font-size: 13px; font-weight: bold; white-space: nowrap; border: 1px solid #eee; cursor: pointer; color: #666; transition: 0.3s; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .filter-chip.active { background: #0049c6; color: white; border-color: #0049c6; }

        /* Grid */
        #courseGridView { animation: fadeIn 0.4s ease-in; width: 100%; }
        .courses-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; }
        
        @media (max-width: 340px) { .courses-grid { grid-template-columns: 1fr; } }

        .course-card { background: white; border-radius: 15px; padding: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); cursor: pointer; position: relative; overflow: hidden; border-bottom: 4px solid #ddd; }
        .course-card:active { transform: translateY(3px); border-bottom-width: 1px; }
        .course-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: #ccc; }

        .cat-matematicas::before { background: var(--col-mate); } .cat-matematicas { border-bottom-color: #cce0ff; }
        .cat-ciencias::before { background: var(--col-ciencias); } .cat-ciencias { border-bottom-color: #ccffe0; }
        .cat-comunicacion::before { background: var(--col-letras); } .cat-comunicacion { border-bottom-color: #ffccd2; }
        .cat-sociales::before { background: var(--col-sociales); } .cat-sociales { border-bottom-color: #ffeebb; }

        .course-card img { width: 50px; height: 50px; margin-bottom: 8px; object-fit: contain; }
        .course-title { font-weight: 800; font-size: 15px; margin-bottom: 2px; color: #333; }
        .course-subtitle { font-size: 11px; color: #999; }

        /* Mapa */
        #pathMapView { display: none; animation: slideIn 0.3s ease-out; width: 100%; }
        .path-container { display: flex; flex-direction: column; align-items: center; padding: 30px 0; position: relative; width: 100%; }
        .path-line-bg { position: absolute; top: 0; bottom: 0; width: 8px; background: #e0e0e0; border-radius: 10px; z-index: 0; }
        
        .path-node { position: relative; z-index: 1; margin-bottom: 50px; display: flex; flex-direction: column; align-items: center; width: 100%; }
        .path-node:nth-child(even) { transform: translateX(25px); }
        .path-node:nth-child(odd) { transform: translateX(-25px); }

        .node-circle { width: 65px; height: 65px; border-radius: 50%; background: white; border: 4px solid #e0e0e0; display: flex; justify-content: center; align-items: center; font-size: 24px; color: #ccc; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); transition: 0.3s; position: relative; }
        
        /* --- ETIQUETAS DE TEXTO CORREGIDAS --- */
        .node-label {
            background: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 11px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 110px;
            position: absolute;
            top: 50%; /* Centrado verticalmente respecto al círculo */
            transform: translateY(-50%); /* Ajuste fino del centrado */
            z-index: 2;
        }

        /* Si es PAR (even), el nodo va a la derecha, texto a la DERECHA del círculo */
        .path-node:nth-child(even) .node-label {
            left: 75px; /* Pegado al lado derecho del círculo */
            right: auto; /* Reseteamos right */
            text-align: left;
        }
        /* Si es IMPAR (odd), el nodo va a la izquierda, texto a la IZQUIERDA del círculo */
        .path-node:nth-child(odd) .node-label {
            right: 75px; /* Pegado al lado izquierdo del círculo */
            left: auto; /* Reseteamos left */
            text-align: right;
        }

        .unlocked { background: white; color: #555; animation: bounce 2s infinite; cursor: pointer; }
        .unlocked::after { content: '★'; font-size: 28px; }
        .unlocked i { display: none; }
        .completed { background: #ffcc00; border-color: #e6b800 !important; color: white; cursor: pointer; }
        .completed i::before { content: "\f00c"; }

        /* --- AVATAR FLOTANTE AL LADO CONTRARIO --- */
        .avatar-on-map {
            position: absolute;
            width: 75px;
            height: auto;
            z-index: 10;
            filter: drop-shadow(2px 4px 5px rgba(0,0,0,0.3));
            animation: floatChar 2s infinite ease-in-out;
            top: -15px; 
        }

        /* En nodos IMPARES (texto a la izquierda), el avatar va a la DERECHA */
        .path-node:nth-child(odd) .avatar-on-map {
            left: auto;
            right: -75px;
        }

        /* En nodos PARES (texto a la derecha), el avatar va a la IZQUIERDA */
        .path-node:nth-child(even) .avatar-on-map {
            right: auto;
            left: -75px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes floatChar { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>

<body>

    <div class="header-bar">
        <div class="back-btn" onclick="handleNavigation()"><i class="fas fa-arrow-left"></i></div>
        <span class="header-title" id="pageTitle">Cursos</span>
    </div>

    <div id="courseGridView">
        <div class="filter-container">
            <div class="filter-chip active" onclick="filterCourses('todos', this)">Todos</div>
            <div class="filter-chip" onclick="filterCourses('matematicas', this)">Matemáticas</div>
            <div class="filter-chip" onclick="filterCourses('ciencias', this)">Ciencias</div>
            <div class="filter-chip" onclick="filterCourses('comunicacion', this)">Letras</div>
            <div class="filter-chip" onclick="filterCourses('sociales', this)">Sociales</div>
        </div>
        <div class="courses-grid" id="gridContainer"></div>
    </div>

    <div id="pathMapView">
        <div class="path-container">
            <div class="path-line-bg"></div>
            <div id="nodesContainer"></div>
        </div>
    </div>

    <script src="cursos_data.js"></script>
    <script>
        // --- POOL DE EMOTES PARA EL MAPA ---
        const MAP_EMOTES = [
            'img/emotes/señalar.png', 
            'img/emotes/señalaremotechica.png'
        ];

        const gridContainer = document.getElementById('gridContainer');
        const pageTitle = document.getElementById('pageTitle');
        const gridView = document.getElementById('courseGridView');
        const pathView = document.getElementById('pathMapView');

        function handleNavigation() {
            if (pathView.style.display === 'block') showGrid();
            else window.location.href = 'index.html';
        }

        function renderGrid(filter = 'todos') {
            gridContainer.innerHTML = '';
            for (const key in cursosDB) {
                const c = cursosDB[key];
                if (filter !== 'todos' && c.cat !== filter) continue;
                const card = document.createElement('div');
                card.className = `course-card cat-${c.cat}`;
                card.onclick = () => showPath(key);
                card.innerHTML = `<img src="${c.img}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3589/3589838.png'">
                                  <div class="course-title">${c.name}</div>
                                  <div class="course-subtitle">${c.topics.length} Temas</div>`;
                gridContainer.appendChild(card);
            }
        }

        window.filterCourses = (cat, btn) => {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            renderGrid(cat);
        };

        window.showPath = (key) => {
            const data = cursosDB[key];
            const cursoProgress = parseInt(localStorage.getItem(key + '_progress')) || 1;

            pageTitle.innerText = data.name;
            gridView.style.display = 'none';
            pathView.style.display = 'block';
            document.querySelector('.path-line-bg').style.background = data.color + '40';

            const container = document.getElementById('nodesContainer');
            container.innerHTML = '';

            data.topics.forEach((topic, idx) => {
                const temaNum = idx + 1;
                const quizID = `${key}_tema${temaNum}`;
                let state = 'locked', icon = '<i class="fas fa-lock"></i>', action = '', border = '#e0e0e0';
                let avatarHtml = '';

                if (temaNum < cursoProgress) {
                    state = 'completed'; border = '#e6b800'; action = `openQuiz('${quizID}')`;
                } else if (temaNum === cursoProgress) {
                    state = 'unlocked'; border = data.color; action = `openQuiz('${quizID}')`;
                    
                    // --- SELECCIÓN ALEATORIA DE AVATAR ---
                    const randomEmote = MAP_EMOTES[Math.floor(Math.random() * MAP_EMOTES.length)];
                    avatarHtml = `<img src="${randomEmote}" class="avatar-on-map">`;
                }

                container.innerHTML += `
                <div class="path-node">
                    <div class="node-circle ${state}" style="border-color:${border}" onclick="${action}">
                        ${avatarHtml}
                        ${icon}
                    </div>
                    <div class="node-label">${topic}</div>
                </div>`;
            });
        };

        window.showGrid = () => {
            pathView.style.display = 'none';
            gridView.style.display = 'block';
            pageTitle.innerText = 'Cursos';
        };

        window.openQuiz = function (quizID) {
            window.location.href = `quiz.html?id=${quizID}`;
        }

        renderGrid();
    </script>
</body>
</html>